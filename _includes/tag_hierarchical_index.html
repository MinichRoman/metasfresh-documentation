{% comment %}
Get the different tags from the given include.pages variable, and create a section for each individual tag.
List links to the respective include.pages for each tag value, using {% include tag_linklist %}.
Thx to http://stackoverflow.com/questions/34242743/distinct-in-jekyll-liquid for getting us started.

This include file goes beyond the existing tag_grouped_index.html as it implements https://github.com/metasfresh/metasfresh-documentation/issues/36

Parameters:
  include.pages: the array of pages to iterate
  include.lang: optional, maybe null; the given language to filter for (lang variable from the front matter); 
	#33 FRESH-514: if set, then only list pages with the given lang
{% endcomment %}

<!-- DEBUG tag_hierarchical_index.html BEGIN -->
<!-- DEBUG tag_hierarchical_index.html lang='{{include.lang}}' -->
{% comment %}<!-- DEBUG pages: it's not a good idea to try and list the pages, their whole html would be pasted in here -->{% endcomment %}

{% comment %} goal: group and sort the pages; for pages having the same first tag, sort them by the number of tags. Pages with less tags are more general and shall be listed first {% endcomment %}
{% comment %} Thanks to https://github.com/mushishi78/jekyll-group-by-array for inspitation {% endcomment %}

<!-- Initialize -->
{% assign __empty_array = '' | split: ',' %}
{% assign tags_as_string = __empty_array %}
{% assign tags_as_string_pages = __empty_array %}
{% assign tags_as_string_sorted = __empty_array %}



{% comment %} trying to stor each pages tags-as-string together with the page {% endcomment %}
{% for current_page in include.pages %}

	{% assign current_tags_as_string = current_page.tags | join ")(" %}
	
	{% assign tags_as_string = tags_as_string | push: current_tags_as_string %}
	{% assign tags_as_string_pages = tags_as_string_pages | push: current_page %}
<!-- DEBUG tag_hierarchical_index.html: page={{ current_page.url }}; tags={{ current_page.tags }}; tags_as_string={{ current_tags_as_string }} -->
{% endfor %}

{% assign tags_as_string_sorted = tags_as_string | sort %}

<!-- DEBUG tag_hierarchical_index.html: iterating grouped_sorted_pages  -->
{% for current_tags_as_string_sorted in tags_as_string_sorted %}

<!-- DEBUG tag_hierarchical_index.html:   current_tags_as_string_sorted={{ current_tags_as_string_sorted }} -->
	{% assign pages_for_current_tag = __empty_array %}

	{% for current_tags_as_string in tags_as_string %}
		{% if current_tags_as_string == current_tags_as_string_sorted %}
			{% assign pages_for_current_tag = pages_for_current_tag | push: tags_as_string_pages[forloop.index0] %}
		{% endif %}
	{% endfor %}

<!-- DEBUG tag_hierarchical_index.html:   current_tags_as_string_sorted={{ current_tags_as_string_sorted }} -->
	{% for current_page_for_current_tag in pages_for_current_tag %}
<!-- DEBUG tag_hierarchical_index.html:      current_page_for_current_tag={{ current_page_for_current_tag.url }} -->
	{% endfor %}
	
{% endfor %}
<!-- DEBUG tag_hierarchical_index.html: done with iterating grouped_sorted_pages  -->

<!-- DEBUG tag_hierarchical_index.html END -->